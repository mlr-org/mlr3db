<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>DataBackend for dplyr/dbplyr — DataBackendDplyr • mlr3db</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="DataBackend for dplyr/dbplyr — DataBackendDplyr" />
<meta property="og:description" content="A mlr3::DataBackend using dplyr::tbl() from packages dplyr/dbplyr.
This includes tibbles and abstract data base connections interfaced by dbplyr.
The latter allows mlr3::Tasks to interface an out-of-memory data base." />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://mlr-org.com"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png" id="hexlogo" alt="mlr-org" /></a>
        <a class="navbar-brand" href="../index.html">mlr3db <small>v0.1.4.9000</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../reference/index.html">
    <span class="fa fa fa fa-file-alt"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://mlr3book.mlr-org.com">
    <span class="fa fa fa fa-link"></span>
     
    mlr3book
  </a>
</li>
        <li>
  <a href="https://github.com/mlr-org/mlr3db">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fab fa fab fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>DataBackend for dplyr/dbplyr</h1>
    <small class="dont-index">Source: <a href='https://github.com/mlr-org/mlr3db/blob/master/R/DataBackendDplyr.R'><code>R/DataBackendDplyr.R</code></a></small>
    <div class="hidden name"><code>DataBackendDplyr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A <a href='https://mlr3.mlr-org.com/reference/DataBackend.html'>mlr3::DataBackend</a> using <code><a href='https://dplyr.tidyverse.org/reference/tbl.html'>dplyr::tbl()</a></code> from packages <a href='https://CRAN.R-project.org/package=dplyr'><span class="pkg">dplyr</span></a>/<a href='https://CRAN.R-project.org/package=dbplyr'><span class="pkg">dbplyr</span></a>.
This includes <code><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibbles</a></code> and abstract data base connections interfaced by <a href='https://CRAN.R-project.org/package=dbplyr'><span class="pkg">dbplyr</span></a>.
The latter allows <a href='https://mlr3.mlr-org.com/reference/Task.html'>mlr3::Task</a>s to interface an out-of-memory data base.</p>
    </div>



    <h2 class="hasAnchor" id="format"><a class="anchor" href="#format"></a>Format</h2>

    <p><a href='https://rdrr.io/pkg/R6/man/R6Class.html'>R6::R6Class</a> object inheriting from <a href='https://mlr3.mlr-org.com/reference/DataBackend.html'>mlr3::DataBackend</a>.</p>
    <h2 class="hasAnchor" id="construction"><a class="anchor" href="#construction"></a>Construction</h2>

    
<pre>DataBackendDplyr$new(data, primary_key = NULL, strings_as_factors = TRUE, connector = NULL)
</pre>
<ul>
<li><p><code>data</code> :: <code><a href='https://dplyr.tidyverse.org/reference/tbl.html'>dplyr::tbl()</a></code><br />
The data object.</p></li>
<li><p><code>primary_key</code> :: <code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code><br />
Name of the primary key column.</p></li>
<li><p><code>strings_as_factors</code> :: <code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code> || <code><a href='https://rdrr.io/r/base/character.html'>character()</a></code><br />
Either a character vector of column names to convert to factors, or a single logical flag:
if <code>FALSE</code>, no column will be converted, if <code>TRUE</code> all string columns (except the primary key).
The backend is queried for distinct values of the respective columns and their levels are stored in <code>$levels</code>.</p></li>
<li><p><code>connector</code> :: <code>function()</code><br />
If not <code>NULL</code>, a function which re-connects to the data base in case the connection has become invalid.
Database connections can become invalid due to timeouts or if the backend is serialized to the file system and then de-serialized again.
This round trip is often performed for parallelization, e.g. to send the objects to remote workers.
<code><a href='https://dbi.r-dbi.org/reference/dbIsValid.html'>DBI::dbIsValid()</a></code> is called to validate the connection.
The function must return just the connection, not a <code><a href='https://dplyr.tidyverse.org/reference/tbl.html'>dplyr::tbl()</a></code> object!</p>
<p>Note that this this function is serialized together with the backend, including possible sensitive information such as login credentials.
These can be retrieved from the stored <a href='https://mlr3.mlr-org.com/reference/DataBackend.html'>mlr3::DataBackend</a>/<a href='https://mlr3.mlr-org.com/reference/Task.html'>mlr3::Task</a>.
To protect your credentials, it is recommended to use the <a href='https://CRAN.R-project.org/package=secret'><span class="pkg">secret</span></a> package.</p></li>
</ul>

<p>Alternatively, use <code><a href='https://mlr3.mlr-org.com/reference/as_data_backend.html'>mlr3::as_data_backend()</a></code> on a <code><a href='https://dplyr.tidyverse.org/reference/tbl.html'>dplyr::tbl()</a></code> to construct a DataBackend for you.
Note that only objects of class <code>"tbl_lazy"</code> will be converted to a DataBackendDplyr (this includes all connectors from <a href='https://CRAN.R-project.org/package=dbplyr'><span class="pkg">dbplyr</span></a>).
Local <code>"tbl"</code> objects such as <code><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibbles</a></code> will converted to a <a href='https://mlr3.mlr-org.com/reference/DataBackendDataTable.html'>DataBackendDataTable</a>.</p>
    <h2 class="hasAnchor" id="fields"><a class="anchor" href="#fields"></a>Fields</h2>

    

<p>All fields from <a href='https://mlr3.mlr-org.com/reference/DataBackend.html'>mlr3::DataBackend</a>, and additionally:</p><ul>
<li><p><code>levels</code> :: named <code><a href='https://rdrr.io/r/base/list.html'>list()</a></code><br />
List of factor levels, named with column names.
Referenced columns get automatically converted to factors in <code>$data()</code> and <code>$head()</code>.</p></li>
<li><p><code>connector</code> :: <code>function()</code><br />
Function which is called to re-connect in case the connection became invalid.</p></li>
<li><p><code>valid</code> :: <code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code><br />
Returns <code>NA</code> if the data does not inherits from <code>"tbl_sql"</code> (i.e., it is not a remote SQL data base).
Returns the result of <code><a href='https://dbi.r-dbi.org/reference/dbIsValid.html'>DBI::dbIsValid()</a></code> otherwise.</p></li>
</ul>

    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    

<p>All methods from <a href='https://mlr3.mlr-org.com/reference/DataBackend.html'>mlr3::DataBackend</a>, and additionally:</p><ul>
<li><p><code>finalize()</code><br />
() -&gt; <code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code><br />
Finalizer which disconnects from the data base.
Is called during garbage collection, but may also be called manually.</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Backend using a in-memory tibble</span>
<span class='no'>data</span> <span class='kw'>=</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span>(<span class='no'>iris</span>)
<span class='no'>data</span>$<span class='no'>Sepal.Length</span>[<span class='fl'>1</span>:<span class='fl'>30</span>] <span class='kw'>=</span> <span class='fl'>NA</span>
<span class='no'>data</span>$<span class='no'>row_id</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>150</span>
<span class='no'>b</span> <span class='kw'>=</span> <span class='no'>DataBackendDplyr</span>$<span class='fu'>new</span>(<span class='no'>data</span>, <span class='kw'>primary_key</span> <span class='kw'>=</span> <span class='st'>"row_id"</span>)

<span class='co'># Object supports all accessors of DataBackend</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>b</span>)</div><div class='output co'>#&gt; &lt;DataBackendDplyr&gt; (150x6)
#&gt;  Sepal.Length Sepal.Width Petal.Length Petal.Width Species row_id
#&gt;            NA         3.5          1.4         0.2  setosa      1
#&gt;            NA         3.0          1.4         0.2  setosa      2
#&gt;            NA         3.2          1.3         0.2  setosa      3
#&gt;            NA         3.1          1.5         0.2  setosa      4
#&gt;            NA         3.6          1.4         0.2  setosa      5
#&gt;            NA         3.9          1.7         0.4  setosa      6
#&gt; [...] (144 rows omitted)</div><div class='input'><span class='no'>b</span>$<span class='no'>nrow</span></div><div class='output co'>#&gt; [1] 150</div><div class='input'><span class='no'>b</span>$<span class='no'>ncol</span></div><div class='output co'>#&gt; [1] 6</div><div class='input'><span class='no'>b</span>$<span class='no'>colnames</span></div><div class='output co'>#&gt; [1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     
#&gt; [6] "row_id"      </div><div class='input'><span class='no'>b</span>$<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='kw'>rows</span> <span class='kw'>=</span> <span class='fl'>100</span>:<span class='fl'>101</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='st'>"Species"</span>)</div><div class='output co'>#&gt;       Species
#&gt; 1: versicolor
#&gt; 2:  virginica</div><div class='input'><span class='no'>b</span>$<span class='fu'>distinct</span>(<span class='no'>b</span>$<span class='no'>rownames</span>, <span class='st'>"Species"</span>)</div><div class='output co'>#&gt; $Species
#&gt; [1] "setosa"     "versicolor" "virginica" 
#&gt; </div><div class='input'>
<span class='co'># Classification task using this backend</span>
<span class='no'>task</span> <span class='kw'>=</span> <span class='kw pkg'>mlr3</span><span class='kw ns'>::</span><span class='no'><a href='https://mlr3.mlr-org.com/reference/TaskClassif.html'>TaskClassif</a></span>$<span class='fu'>new</span>(<span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"iris_tibble"</span>, <span class='kw'>backend</span> <span class='kw'>=</span> <span class='no'>b</span>, <span class='kw'>target</span> <span class='kw'>=</span> <span class='st'>"Species"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>task</span>)</div><div class='output co'>#&gt; &lt;TaskClassif:iris_tibble&gt; (150 x 5)
#&gt; * Target: Species
#&gt; * Properties: multiclass
#&gt; * Features (4):
#&gt;   - dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width</div><div class='input'><span class='no'>task</span>$<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>()</div><div class='output co'>#&gt;    Species Petal.Length Petal.Width Sepal.Length Sepal.Width
#&gt; 1:  setosa          1.4         0.2           NA         3.5
#&gt; 2:  setosa          1.4         0.2           NA         3.0
#&gt; 3:  setosa          1.3         0.2           NA         3.2
#&gt; 4:  setosa          1.5         0.2           NA         3.1
#&gt; 5:  setosa          1.4         0.2           NA         3.6
#&gt; 6:  setosa          1.7         0.4           NA         3.9</div><div class='input'>
<span class='co'># Create a temporary SQLite data base</span>
<span class='no'>con</span> <span class='kw'>=</span> <span class='kw pkg'>DBI</span><span class='kw ns'>::</span><span class='fu'><a href='https://dbi.r-dbi.org/reference/dbConnect.html'>dbConnect</a></span>(<span class='kw pkg'>RSQLite</span><span class='kw ns'>::</span><span class='fu'><a href='https://rsqlite.r-dbi.org/reference/SQLite.html'>SQLite</a></span>(), <span class='st'>":memory:"</span>)
<span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/copy_to.html'>copy_to</a></span>(<span class='no'>con</span>, <span class='no'>data</span>)
<span class='no'>tbl</span> <span class='kw'>=</span> <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/tbl.html'>tbl</a></span>(<span class='no'>con</span>, <span class='st'>"data"</span>)

<span class='co'># Define a backend on a subset of the data base</span>
<span class='no'>tbl</span> <span class='kw'>=</span> <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select_all.html'>select_at</a></span>(<span class='no'>tbl</span>, <span class='fu'><a href='https://rdrr.io/r/base/sets.html'>setdiff</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>tbl</span>), <span class='st'>"Sepal.Width"</span>)) <span class='co'># do not use column "Sepal.Width"</span>
<span class='no'>tbl</span> <span class='kw'>=</span> <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>tbl</span>, <span class='no'>row_id</span> <span class='kw'>%in%</span> <span class='fl'>1</span>:<span class='fl'>120</span>) <span class='co'># Use only first 120 rows</span>
<span class='no'>b</span> <span class='kw'>=</span> <span class='no'>DataBackendDplyr</span>$<span class='fu'>new</span>(<span class='no'>tbl</span>, <span class='kw'>primary_key</span> <span class='kw'>=</span> <span class='st'>"row_id"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='no'>b</span>)</div><div class='output co'>#&gt; &lt;DataBackendDplyr&gt; (120x5)
#&gt;  Sepal.Length Petal.Length Petal.Width Species row_id
#&gt;            NA          1.4         0.2  setosa      1
#&gt;            NA          1.4         0.2  setosa      2
#&gt;            NA          1.3         0.2  setosa      3
#&gt;            NA          1.5         0.2  setosa      4
#&gt;            NA          1.4         0.2  setosa      5
#&gt;            NA          1.7         0.4  setosa      6
#&gt; [...] (114 rows omitted)</div><div class='input'>
<span class='co'># Query disinct values</span>
<span class='no'>b</span>$<span class='fu'>distinct</span>(<span class='no'>b</span>$<span class='no'>rownames</span>, <span class='st'>"Species"</span>)</div><div class='output co'>#&gt; $Species
#&gt; [1] "setosa"     "versicolor" "virginica" 
#&gt; </div><div class='input'>
<span class='co'># Query number of missing values</span>
<span class='no'>b</span>$<span class='fu'>missings</span>(<span class='no'>b</span>$<span class='no'>rownames</span>, <span class='no'>b</span>$<span class='no'>colnames</span>)</div><div class='output co'>#&gt; Sepal.Length Petal.Length  Petal.Width      Species       row_id 
#&gt;           30            0            0            0            0 </div><div class='input'>
<span class='co'># Note that SQLite does not support factors, column Species has been converted to character</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>b</span>$<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(), <span class='no'>class</span>)</div><div class='output co'>#&gt; $Sepal.Length
#&gt; [1] "numeric"
#&gt; 
#&gt; $Petal.Length
#&gt; [1] "numeric"
#&gt; 
#&gt; $Petal.Width
#&gt; [1] "numeric"
#&gt; 
#&gt; $Species
#&gt; [1] "factor"
#&gt; 
#&gt; $row_id
#&gt; [1] "integer"
#&gt; </div><div class='input'>
<span class='co'># Cleanup</span>
<span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span>(<span class='no'>tbl</span>)
<span class='kw pkg'>DBI</span><span class='kw ns'>::</span><span class='fu'><a href='https://dbi.r-dbi.org/reference/dbDisconnect.html'>dbDisconnect</a></span>(<span class='no'>con</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#format">Format</a></li>
      <li><a href="#construction">Construction</a></li>
      <li><a href="#fields">Fields</a></li>
      <li><a href="#methods">Methods</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Michel Lang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


